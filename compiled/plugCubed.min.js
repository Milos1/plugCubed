/*
 Copyright (c) 2012-2013 by Jeremy "Colgate" Richardson and Thomas "TAT" Andresen

 Permission to use and/or distribute this software for any purpose without fee is hereby granted,
 provided that the above copyright notice and this permission notice appear in all copies.

 THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHORS DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE
 INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHORS
 BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER
 RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
 OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

 @author  Jeremy "Colgate" Richardson
 @author  Thomas "TAT" Andresen
*/
var c=void 0,e=!0,f=null,g=!1;if(Class===c){var h=g,l=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;n.Class=function(){};Class.extend=function(a){function b(){!h&&n.init&&n.init.apply(n,arguments)}var d=n.prototype;h=e;var j=new n;h=g;for(var k in a)j[k]="function"==typeof a[k]&&"function"==typeof d[k]&&l.test(a[k])?function(a,b){return function(){var j=n._super;n._super=d[a];var k=b.apply(n,arguments);n._super=j;return k}}(k,a[k]):a[k];b.prototype=j;b.extend=arguments.callee;return b}}n!==c&&n.close();
Math.ka=function(){return 1+Math.floor(10*Math.random())};
var p=Class.extend({u:{},X:function(){return"undefined"!==typeof pdpSocket&&"http://socket.plugpony.net:9000/gateway"===pdpSocket._base_url},init:function(){this.version="Running plug&#179; version 1.0.0";this.proxy={n:{P:$.proxy(this.P,this),O:$.proxy(this.O,this),S:$.proxy(this.S,this),N:$.proxy(this.N,this),Q:$.proxy(this.Q,this),R:$.proxy(this.R,this)},G:$.proxy(this.G,this),onVoteUpdate:$.proxy(this.onVoteUpdate,this),F:$.proxy(this.F,this),H:$.proxy(this.H,this),I:$.proxy(this.I,this),D:$.proxy(this.D,
this)};this.e={la:"#66FFFF",ha:"#FF0000",z:"#FFFF00",L:"#66FFFF",curates:"#00FF00",userJoin:"#3366FF",userLeave:"#3366FF"};this.W="I'm away from keyboard.";this.log(this.version,f,this.e.z);this.log("Use '/commands' to see expanded chat commands.",f,this.e.L);Models.chat.o===c&&(Models.chat.o=Models.chat.chatCommand);ChatModel.o===c&&(ChatModel.o=ChatModel.chatCommand);Models.chat.chatCommand=this.V;ChatModel.chatCommand=this.V;this.ga();$("body").prepend('<style type="text/css" id="plugcubed-css">\n#side-left .sidebar-content p { margin: 0; padding-top: 2px; text-indent: 15px; font-size: 10px; height:15px; }\n#side-left .sidebar-content p:hover { color:#66ff33; }\n#side-left .sidebar-content p:first-child { padding-top: 0px !important; }\n#side-left .sidebar-content h1.users { text-indent: 8px; color: #6FF; font-size: 16px; }\n#side-left .sidebar-content h1.waitlistspot { color: #66FFFF; text-align: left; font-size: 15px; margin-left: 8px }\n#side-left .sidebar-content p span.admin_current,#side-left .sidebar-content p span.admin_meh,#side-left .sidebar-content p span.admin_undecided,#side-left .sidebar-content p span.admin_woot,#side-left .sidebar-content p span.ambassador_current,\n#side-left .sidebar-content p span.ambassador_meh,#side-left .sidebar-content p span.ambassador_undecided,#side-left .sidebar-content p span.ambassador_woot,#side-left .sidebar-content p span.bouncer_current,#side-left .sidebar-content p span.bouncer_meh,\n#side-left .sidebar-content p span.bouncer_undecided,#side-left .sidebar-content p span.bouncer_woot,#side-left .sidebar-content p span.host_current,#side-left .sidebar-content p span.host_meh,#side-left .sidebar-content p span.host_undecided,\n#side-left .sidebar-content p span.host_woot,#side-left .sidebar-content p span.manager_current,#side-left .sidebar-content p span.manager_meh,#side-left .sidebar-content p span.manager_undecided,#side-left .sidebar-content p span.manager_woot,#side-left .sidebar-content p span.void {\n    background: url(http://tatdk.github.com/plugCubed/images/sprites.png) no-repeat;width:15px;height: 15px;position: relative;left: -5px;top:4px;display:inline-block\n}\n#side-left .sidebar-content p span.admin_current {background-position: -45px 0;}\n#side-left .sidebar-content p span.admin_meh {background-position: -30px 0;}\n#side-left .sidebar-content p span.admin_undecided {background-position: -15px 0;}\n#side-left .sidebar-content p span.admin_woot {background-position: 0 0;}\n#side-left .sidebar-content p span.ambassador_current {background-position: -45px -15px;}\n#side-left .sidebar-content p span.ambassador_meh {background-position: -30px -15px;}\n#side-left .sidebar-content p span.ambassador_undecided {background-position: -15px -15px;}\n#side-left .sidebar-content p span.ambassador_woot {background-position: 0 -15px;}\n#side-left .sidebar-content p span.bouncer_current {background-position: -45px -60px;}\n#side-left .sidebar-content p span.bouncer_meh {background-position: -30px -60px;}\n#side-left .sidebar-content p span.bouncer_undecided {background-position: -15px -60px;}\n#side-left .sidebar-content p span.bouncer_woot {background-position: 0 -60px;}\n#side-left .sidebar-content p span.host_current {background-position: -45px -30px;}\n#side-left .sidebar-content p span.host_meh {background-position: -30px -30px;}\n#side-left .sidebar-content p span.host_undecided {background-position: -15px -30px;}\n#side-left .sidebar-content p span.host_woot {background-position: 0 -30px;}\n#side-left .sidebar-content p span.manager_current {background-position: -45px -45px;}\n#side-left .sidebar-content p span.manager_meh {background-position: -30px -45px;}\n#side-left .sidebar-content p span.manager_undecided {background-position: -15px -45px;}\n#side-left .sidebar-content p span.manager_woot {background-position: 0 -45px;}\n#side-left .sidebar-content p span.void {background-position: 0px -75px;}\n#plugcubed-gui { position: absolute; margin-left:-522px; top: -320px; }\n#plugcubed-gui h2 { background-color: #0b0b0b; height: 112px; width: 156px; margin: 0; color: #fff; font-size: 13px; font-variant: small-caps; padding: 8px 0 0 12px; border-top: 1px dotted #292929; }\n#plugcubed-gui ul {list-style-type:none; margin:0; padding:0;}\n#plugcubed-gui li {float:left;}\n#plugcubed-gui p { background: #0b0b0b; height: 32px; padding-top: 8px; padding-left: 8px; cursor: pointer; font-variant: small-caps; width: 84px; font-size: 15px; margin: 0; }\n#plugcubed-gui p:hover {background-color: #3C3C3C}\n#plugcubed-gui h1 { background-color: #0b0b0b; height: 32px; padding-top: 8px; padding-left: 8px; cursor: pointer; font-variant: small-caps; width: 84px; font-size: 20px; margin: 0; }\n.sidebar {\nposition: fixed;\ntop: 0;\nheight: 100%;\nwidth: 200px;\nz-index: 99999;\n-moz-user-select: none;\n-khtml-user-select: none;\n-webkit-user-select: none;\nuser-select: none;\nbackground: #424242;\n}\n.sidebar#side-left {\nleft: -220px;\nz-index: 99999;\n}\n.sidebar#side-right {\nright: -190px;\nz-index: 99999;\n}\n.sidebar-handle {\nwidth: 12px;\nheight: 100%;\nz-index: 99999;\nmargin: 0;\npadding: 0;\nbackground: #474747;\nbox-shadow: 0px 0px 15px 0px rgba(0, 0, 0, .9);\ncursor: "ne-resize";\n}\n.sidebar-handle span {\ndisplay: block;\nposition: absolute;\nwidth: 10px;\ntop: 50%;\ntext-align: center;\nletter-spacing: -1px;\ncolor: #000;\n}\n#side-left .sidebar-handle {\nfloat: right;\n}\n.sidebar-content {\nposition: absolute;\nwidth: 185px;\nfloat: left;\nheight: 100%;\npadding: 15px;\noverflow: scroll;\n}\n#side-left a {\ndisplay: block;\nmin-width: 100%;\ncursor: pointer;\npadding: 5px;\nborder-radius: 3px;\n}\n#side-left a span {\npadding-right: 8px;\n}\n#side-left a:hover {\nbackground-color: #333;\n}\n#side-left hr {\nheight: 0;\nborder: none;\nborder-top: 1px solid #333;\npadding: 0;\nmargin: 15px 0;\n}\n#side-right .sidebar-handle {\nfloat: left;\n}\n#side-right a {\ndisplay: block;\nmin-width: 100%;\ncursor: pointer;\npadding: 5px;\nborder-radius: 3px;\n}\n#side-right a span {\npadding-right: 8px;\n}\n#side-right a:hover {\nbackground-color: #333;\n}\n#side-right hr {\nheight: 0;\nborder: none;\nborder-top: 1px solid #333;\npadding: 0;\nmargin: 15px 0;\n}\n[class^="status-"], [class*=" status-"] {\nborder-radius: 50%;\nwidth: 10px;\nheight: 10px;\nbackground: yellow;\ndisplay: inline-block;\nmargin-right: 5px;\n}\n.status-on { background: green; }\n.status-off { background: red; }\n</style>');
$("body").append('<div id="side-left" class="sidebar">    <div class="sidebar-content"></div></div><div id="side-right" class="sidebar">    <div class="sidebar-handle"><span>||</span></div>    <div class="sidebar-content"></div></div>');$("body").append('<script type="text/javascript">\n/**\n* hoverIntent r6 // 2011.02.26 // jQuery 1.5.1+\n* <http://cherne.net/brian/resources/jquery.hoverIntent.html>\n* \n* @param  f  onMouseOver function || An object with configuration options\n* @param  g  onMouseOut function  || Nothing (use configuration options object)\n* @author    Brian Cherne brian(at)cherne(dot)net\n*/\n(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind(\'mousemove\',track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t)}if(e.type==\'mouseenter\'){pX=ev.pageX;pY=ev.pageY;$(ob).bind(\'mousemove\',track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}}else{$(ob).unbind(\'mousemove\',track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)}}};return this.bind(\'mouseenter\',handleHover).bind(\'mouseleave\',handleHover)}})(jQuery);\nif (jQuery.easing.easeOutQuart === undefined) jQuery.easing.easeOutQuart = function (a,b,c,d,e) { return -d*((b=b/e-1)*b*b*b-1)+c; }\n$("#side-right")\n    .hoverIntent(function() {\n        var timeout_r = $(this)\n            .data("timeout_r");\n        if (timeout_r) {\n            clearTimeout(timeout_r);\n        }\n        $(this)\n            .animate({\n                "right": "0px"\n            }, 300, "easeOutQuart");\n    }, function() {\n        $(this)\n            .data("timeout_r", setTimeout($.proxy(function() {\n            $(this)\n                .animate({\n                    "right": "-190px"\n                }, 300, "easeOutQuart");\n       }, this), 500));\n    });\n\x3c/script>');
this.fa();this.ea();this.settings.g?(this.J(),this.T()):this.Z();var a=API.getUsers(),b;for(b in a){var d=a[b];d.i===c&&(d.i=0);d.m===c&&(d.m=0);d.f===c&&(d.f=0);d.joinTime===c&&(d.joinTime=this.Y())}},close:function(){Models.chat.chatCommand=Models.chat.o;ChatModel.chatCommand=ChatModel.o;API.removeEventListener(API.DJ_ADVANCE,this.proxy.G);API.removeEventListener(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.removeEventListener(API.CURATE_UPDATE,this.proxy.F);API.removeEventListener(API.USER_JOIN,
this.proxy.H);API.removeEventListener(API.USER_LEAVE,this.proxy.I);API.removeEventListener(API.CHAT,this.proxy.D);for(var a in n.u)a===c||n.u[a]===c||($("#plugcubed-btn-"+a).unbind(),delete n.u[a]);$("#plugcubed-css").remove();$("#plugcubed-js").remove();$("#side-right").remove();$("#side-left").remove()},T:function(){$("#side-left").show().animate({left:"0px"},300,"easeOutQuart");this.X()&&(userlistShow===e&&$("#pdpUsers").hide(),$("#pdpUsersToggle").hide())},Z:function(){var a=-$("#side-left").width()-
20;$("#side-left").animate({left:a+"px"},300,"easeOutQuart",function(){$("#side-left").hide()});this.X()&&(userlistShow===e&&$("#pdpUsers").show(),$("#pdpUsersToggle").show())},settings:{K:g,B:"",k:g,a:g,g:g,j:g,n:g,notify:g},ga:function(){if(localStorage.aa!==c){var a=JSON.parse(localStorage.aa),b;for(b in this.settings)a[b]!==c&&(this.settings[b]=a[b]);this.settings.K=g;this.settings.k&&this.ba();this.settings.g&&(this.J(),this.T())}},saveSettings:function(){localStorage.aa=JSON.stringify(this.settings)},
ea:function(){API.addEventListener(API.DJ_ADVANCE,this.proxy.G);API.addEventListener(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.addEventListener(API.CURATE_UPDATE,this.proxy.F);API.addEventListener(API.USER_JOIN,this.proxy.H);API.addEventListener(API.USER_LEAVE,this.proxy.I);API.addEventListener(API.CHAT,this.proxy.D)},fa:function(){this.q(this.settings.k,"woot","Autowoot",this.proxy.n.P);this.q(this.settings.a,"join","Autojoin",this.proxy.n.O);this.q(this.settings.g,"userlist","Userlist",this.proxy.n.S);
this.q(this.settings.j,"autorespond","AFK Status",this.proxy.n.N);this.q(this.settings.notify,"notify","Notify",this.proxy.n.Q);this.q(!DB.settings.streamDisabled,"stream","Stream",this.proxy.n.R)},q:function(a,b,d,j){this.u[b]===c&&(0<$("#side-right .sidebar-content").children().length&&$("#side-right .sidebar-content").append("<hr />"),$("#side-right .sidebar-content").append('<a id="plugcubed-btn-'+b+'"><div class="status-'+(a?"on":"off")+'"></div>'+d+"</a>"),$("#plugcubed-btn-"+b).click(j),this.u[b]=
{text:d,callback:j})},d:function(a,b){$("#plugcubed-btn-"+a).find('[class^="status-"], [class*=" status-"]').attr("class","status-"+(b===e?"on":"off"))},J:function(){0<$("#side-left .sidebar-content").children().length&&$("#side-left .sidebar-content").append("<hr />");$("#side-left .sidebar-content").html('<h1 class="users">Users: '+API.getUsers().length+"</h1>");var a=Models.room.getWaitListPosition();a!==f&&$("#side-left .sidebar-content").append('<h1 class="waitlistspot">Waitlist:</span> '+a+
" / "+Models.room.data.waitList.length+"</h3><br />");var a=API.getUsers(),b;for(b in a)this.ca(a[b])},log:function(a,b,d,j){var k="";d&&(k='style="color:'+d+';"');a=b?'<div class="chat-message"><span class="chat-from" '+k+">"+b+'</span><span class="chat-text" '+k+">: "+a+"</span></div>":'<div class="chat-message"><span class="chat-text" '+k+">"+a+"</span></div>";$("#chat-messages");$("#chat-messages").scrollTop();$("#chat-messages").outerHeight();b=Popout?Popout.Chat.chatMessages:Chat.chatMessages;
d=b.scrollTop()>b[0].scrollHeight-b.height()-20;b.append(a);d&&b.scrollTop(b[0].scrollHeight);j&&$(a).click(function(){this.childNodes[0].style.color=j})},ca:function(a){var b=a.username,d;d=Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.BOUNCER?"bouncer":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.MANAGER?"manager":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.COHOST?"host":Models.room.data.staff[a.id]&&5==Models.room.data.staff[a.id]?
"host":Models.room.ambassadors[a.id]?"ambassador":Models.room.admins[a.id]?"admin":"normal";0<Models.room.data.djs.length&&Models.room.data.djs[0].user.id==a.id?"normal"===d?this.C("void","#66FFFF",b):this.C(d+"_current","#66FFFF",b):"normal"===d?this.C("void",this.U(a.vote),b):this.C(d+this.ja(a.vote),this.U(a.vote),b)},U:function(a){if(a===c)return"#FFFFFF";switch(a){case -1:return"#ED1C24";case 1:return"#3FFF00";default:return"#FFFFFF"}},ja:function(a){var b="";if(a===c)b="undecided";else switch(a){case -1:b=
"meh";break;case 1:b="woot";break;default:b="undecided"}return"_"+b},C:function(a,b,d){$("#side-left .sidebar-content").append('<p><span style="cursor:pointer;color:'+b+";"+(0<Models.room.data.djs.length&&Models.room.data.djs[0].username==d?"font-size:15px;font-weight:bold;":"")+"\" onclick=\"$('#chat-input-field').val($('#chat-input-field').val() + '@"+d+' \').focus();"><span class="'+a+'"></span>'+d+"</span></p>")},getUser:function(a){"@"===a.substr(0,1)&&(a=a.substr(1));a=a.trim();var b=API.getUsers(),
d;for(d in b)if(b[d].username.toLowerCase()===a.toLowerCase()||b[d].id.toLowerCase()===a.toLowerCase())return b[d];return f},M:function(a,b){if(Models.room.data.staff[Models.user.data.id]&&Models.room.data.staff[Models.user.data.id]>=Models.user.BOUNCER){var d;switch(b){case "kick":d=ModerationKickUserService;break;case "removedj":d=ModerationRemoveDJService;break;case "adddj":d=ModerationAddDJService;break;default:log("Unknown moderation");return}var j=this.getUser(a);j===f?log("user not found"):
new d(j.id," ")}},da:function(a){a=this.getUser(a);if(a===f)log("user not found");else{var b,d,j,k=a.djPoints+a.curatorPoints+a.listenerPoints,m=a.i+a.m;b=Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.FEATUREDDJ?"Featured DJ":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.BOUNCER?"Bouncer":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.MANAGER?"Manager":Models.room.data.staff[a.id]&&Models.room.data.staff[a.id]==Models.user.COHOST?
"Co-Host":Models.room.data.staff[a.id]&&5==Models.room.data.staff[a.id]?"Host":Models.room.ambassadors[a.id]?"Ambassador":Models.room.admins[a.id]?"Admin":"User";switch(a.status){case -1:d="Idle";break;default:d="Available";break;case 1:d="AFK";break;case 2:d="Working";break;case 3:d="Sleeping"}switch(a.vote){case -1:j="Meh";break;default:j="Undecided";break;case 1:j="Woot"}this.log('<table style="width:100%"><tr><td colspan="2"><strong>Name</strong>: <span style="color:#FFFFFF">'+a.username+'</span></td></tr><tr><td colspan="2"><strong>ID</strong>: <span style="color:#FFFFFF">'+
a.id+'</span></td></tr><tr><td><strong>Rank</strong>: <span style="color:#FFFFFF">'+b+'</span></td><td><strong>Time Joined</strong>: <span style="color:#FFFFFF">'+a.joinTime+'</span></td></tr><tr><td><strong>Status</strong>: <span style="color:#FFFFFF">'+d+'</span></td><td><strong>Vote</strong>: <span style="color:#FFFFFF">'+j+'</span></td></tr><tr><td><strong>Points</strong>: <span style="color:#FFFFFF">'+k+'</span></td><td><strong>Fans</strong>: <span style="color:#FFFFFF">'+a.fans+'</span></td></tr><tr><td><strong>Woot Count</strong>: <span style="color:#FFFFFF">'+
a.i+'</span></td><td><strong>Meh Count</strong>: <span style="color:#FFFFFF">'+a.m+'</span></td></tr><tr><td colspan="2" ><strong>Woot/Meh ratio</strong>: <span style="color:#FFFFFF">'+(0===m?"0":(a.i/m).toFixed(2))+"</span></td></tr></table>",f,"#cc00cc")}},P:function(){this.settings.k=!this.settings.k;this.d("woot",this.settings.k);this.settings.k&&$("#button-vote-positive").click();this.saveSettings()},O:function(){this.settings.a=!this.settings.a;this.d("join",this.settings.a);this.settings.a&&
0<$("#button-dj-waitlist-join").length&&API.waitListJoin();this.saveSettings()},S:function(){this.settings.g=!this.settings.g;this.d("userlist",this.settings.g);this.settings.g?(this.J(),this.T()):($("#side-left .sidebar-content").empty(),this.Z());this.saveSettings()},N:function(){this.settings.j=!this.settings.j;this.d("autorespond",this.settings.j);if(this.settings.j){var a=prompt("Please enter your away message here.\nThis is what you will reply via @mention.",""===this.settings.B?this.W:this.settings.B);
if(a===f){this.settings.j=g;this.d("autorespond",g);return}this.settings.B=""===a.trim()?this.W:a;2!=Models.user.data.status&&Models.user.changeStatus(1)}else Models.user.changeStatus(0);this.saveSettings()},Q:function(){this.settings.notify=!this.settings.notify;this.d("notify",this.settings.notify);this.log("Join/leave alerts "+(this.settings.notify?"enabled":"disabled"),f,n.e.z);this.saveSettings()},R:function(){this.d("stream",DB.settings.streamDisabled);API.sendChat(DB.settings.streamDisabled?
"/stream on":"/stream off")},onVoteUpdate:function(a){var b=Models.room.userHash[a.user.id];this.A();0!==b.f&&(1==b.f?b.i--:-1==b.f&&b.m--);1==a.vote?b.i++:-1==a.vote&&b.m++;b.f=a.vote},F:function(a){var b=API.getMedia();this.settings.notify===e&&this.log(a.user.username+" added "+b.author+" - "+b.title,f,this.e.curates);Models.room.userHash[a.user.id].curated=e;this.A()},G:function(){setTimeout($.proxy(this.ia,this),Math.ka());this.A();var a=API.getUsers(),b;for(b in a)a[b].f=0},ia:function(){this.settings.k&&
this.ba();"block"===$("#button-dj-waitlist-join").css("display")&&this.settings.a&&API.waitListJoin()},ba:function(){var a=Models.room.data.djs[0];a!==f&&a!=API.getSelf()&&$("#button-vote-positive").click()},H:function(a){this.settings.notify===e&&this.log(a.username+" joined the room",f,this.e.userJoin);a=Models.room.userHash[a.id];a.i===c&&(a.i=0);a.m===c&&(a.m=0);a.f===c&&(a.f=0);a.joinTime===c&&(a.joinTime=this.Y());this.A()},I:function(a){this.settings.notify===e&&this.log(a.username+" left the room",
f,this.e.userLeave);this.A()},D:function(a){"mention"==a.type&&(Models.room.data.staff[a.fromID]&&Models.room.data.staff[a.fromID]>=Models.user.BOUNCER&&0<a.message.indexOf("!disable")?this.settings.a?(this.settings.a=g,this.d("join",this.settings.a),this.saveSettings(),API.waitListLeave(),API.sendChat("@"+a.from+" Autojoin disabled")):API.sendChat("@"+a.from+" Autojoin was not enabled"):this.settings.j&&!this.settings.K&&(this.settings.K=e,setTimeout(function(){n.settings.K=g;n.saveSettings()},18E4),
API.sendChat("@"+a.from+" "+this.settings.B)))},A:function(){this.settings.g&&this.J()},Y:function(){var a=new Date,b=a.getMinutes();return a.getHours()+":"+((10>b?"0":"")+b)},V:function(a){if(Models.chat.o(a)===e)return("/stream on"==a||"/stream off"==a)&&n.d("stream",!DB.settings.streamDisabled),"/afk"==a&&n.settings.a&&(n.settings.a=g,n.d("join",g),n.saveSettings()),e;if(0===a.indexOf("/commands"))return a="<strong>User Commands</strong>;/nick - change username;/idle - set status to idle;/avail - set status to available;/afk - set status to afk;/work - set status to working;/sleep - set status to sleeping;/leave - leaves dj booth/waitlist;/woot - woots current song;/meh - mehs current song;/curate - add current song to your selected playlist;/getpos - get current waitlist position;/version - displays version number;/commands - shows this list".split(";"),
n.log(a.join("<br />"),f,n.e.la),Models.user.hasPermission(Models.user.BOUNCER)&&(a="<strong>Moderation Commands</strong>;/whois (username) - gives general information about user;/skip - skip current song;/kick (username) - kicks targeted user;/lock - locks DJ booth;/unlock - unlocks DJ booth;/add (username) - adds targeted user to dj booth/waitlist;/remove (username) - removes targeted user from dj booth/waitlist".split(";"),n.log(a.join("<br />"),f,n.e.ha)),e;if("/idle"==a)return Models.user.changeStatus(-1),
e;if("/avail"==a||"/available"==a)return Models.user.changeStatus(0),e;if("/brb"==a||"/away"==a)return Models.user.changeStatus(1),n.settings.a&&(n.settings.a=g,n.d("join",g),n.saveSettings()),e;if("/work"==a||"/working"==a)return Models.user.changeStatus(2),e;if("/sleep"==a||"/sleeping"==a)return Models.user.changeStatus(3),n.settings.a&&(n.settings.a=g,n.d("join",g),n.saveSettings()),e;if("/join"==a)return API.waitListJoin(),e;if("/leave"==a)return API.waitListLeave(),e;if("/woot"==a)return $("#button-vote-positive").click(),
e;if("/meh"==a)return $("#button-vote-negative").click(),e;if("/version"==a)return n.log(n.version,f,n.e.z),e;if(0===a.indexOf("/nick "))return Models.user.changeDisplayName(a.substr(6)),e;if(0===a.indexOf("/curate"))return new DJCurateService(Models.playlist.selectedPlaylistID),setTimeout(function(){Dialog.closeDialog()},500),e;if("/alertsoff"==a)return n.settings.notify&&(n.log("Join/leave alerts disabled",f,n.e.z),n.settings.notify=g,n.d("notify",g)),e;if("/alertson"==a)return n.settings.notify||
(n.log("Join/leave alerts enabled",f,n.e.z),n.settings.notify=e,n.d("notify",e)),e;if("/getpos"==a)return a=Models.room.getWaitListPosition(),a!==f?n.log("Position in waitlist "+a+"/"+Models.room.data.waitList.length,f,n.e.L):n.log("Not in waitlist",f,n.e.L),e;if(Models.user.hasPermission(Models.user.BOUNCER)){if(0===a.indexOf("/whois "))return n.da(a.substr(7)),e;if("/skip"==a)return new ModerationForceSkipService,e;if(0===a.indexOf("/kick "))return n.M(a.substr(6),"kick"),e;if(0===a.indexOf("/add "))return n.M(a.substr(5),
"adddj"),e;if(0===a.indexOf("/remove "))return n.M(a.substr(8),"removedj"),e}if(Models.user.hasPermission(Models.user.MANAGER)){if(0===a.indexOf("/lock"))return $.ajax({url:"http://plug.dj/_/gateway/room.update_options",type:"POST",data:JSON.stringify({service:"room.update_options",body:[Slug,{boothLocked:e,waitListEnabled:Models.room.data.waitListEnabled,maxPlays:Models.room.data.maxPlays,maxDJs:Models.room.data.maxDJs}]}),async:this.async,dataType:"json",contentType:"application/json"}).done,e;
if(0===a.indexOf("/unlock"))return $.ajax({url:"http://plug.dj/_/gateway/room.update_options",type:"POST",data:JSON.stringify({service:"room.update_options",body:[Slug,{boothLocked:g,waitListEnabled:Models.room.data.waitListEnabled,maxPlays:Models.room.data.maxPlays,maxDJs:Models.room.data.maxDJs}]}),async:this.async,dataType:"json",contentType:"application/json"}).done,e}return g}});
if(jQuery&&1===$("#plugcubed-js").length&&-1===$("#plugcubed-js").attr("src").indexOf("raw.github.com"))var n=new p;else confirm("You need to update your plugCubed URL\nPlease click OK to visit our page to get the new URL.")&&window.open("http://tatdk.github.com/plugCubed/","_blank");
