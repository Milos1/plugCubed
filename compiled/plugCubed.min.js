/*
 Copyright (c) 2012-2013 by Jeremy "Colgate" Richardson and Thomas "TAT" Andresen

 Permission to use and/or distribute this software for any purpose without fee is hereby granted,
 provided that the above copyright notice and this permission notice appear in all copies.

 THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHORS DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE
 INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHORS
 BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER
 RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
 OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

 @author  Jeremy "Colgate" Richardson
 @author  Thomas "TAT" Andresen
*/
var e=void 0,g=!0,h=null,k=!1;
if(Class===e){var m=k,q=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;plugCubed.Class=function(){};Class.extend=function(b){function c(){!m&&plugCubed.init&&plugCubed.init.apply(plugCubed,arguments)}var d=plugCubed.prototype;m=g;var f=new plugCubed;m=k;for(var j in b)f[j]="function"==typeof b[j]&&"function"==typeof d[j]&&q.test(b[j])?function(b,c){return function(){var f=plugCubed._super;plugCubed._super=d[b];var j=c.apply(plugCubed,arguments);plugCubed._super=f;return j}}(j,b[j]):b[j];c.prototype=
f;c.extend=arguments.callee;return c}}plugCubed!==e&&plugCubed.close();Math.ra=function(){return 1+Math.floor(10*Math.random())};function r(b){a="#"!==b.substr(0,1)?"#"+b:b;return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(a)}
var t=Class.extend({A:{},ca:function(){return"undefined"!==typeof pdpSocket&&"http://socket.plugpony.net:9000/gateway"===pdpSocket._base_url},init:function(){this.version="Running plug&#179; version 1.0.2";this.proxy={g:{S:$.proxy(this.S,this),R:$.proxy(this.R,this),W:$.proxy(this.W,this),Q:$.proxy(this.Q,this),U:$.proxy(this.U,this),V:$.proxy(this.V,this),T:$.proxy(this.T,this)},J:$.proxy(this.J,this),onVoteUpdate:$.proxy(this.onVoteUpdate,this),I:$.proxy(this.I,this),K:$.proxy(this.K,this),L:$.proxy(this.L,
this),H:$.proxy(this.H,this)};this.a={sa:"#66FFFF",na:"#FF0000",B:"#FFFF00",z:"#66FFFF",curates:"#00FF00",userJoin:"#3366FF",userLeave:"#3366FF"};this.ba="I'm away from keyboard.";this.F=$('<style type="text/css"></css>');$("head").append(this.F);this.log(this.version,h,this.a.B);this.log("Use '/commands' to see expanded chat commands.",h,this.a.z);Models.chat.q===e&&(Models.chat.q=Models.chat.chatCommand);ChatModel.q===e&&(ChatModel.q=ChatModel.chatCommand);Models.chat.chatCommand=this.aa;ChatModel.chatCommand=
this.aa;Dialog.getInputField=function(b,c,d,l,p,s){b=$('<input type="text" name="'+b+'" placeholder="'+d+'" maxlength="'+p+'" onKeyPress="return Dialog.onKeyPressHandler(event)"/>').attr("value",l).data("ph",d).focus($.proxy(this.onInputFocus,this)).blur($.proxy(this.onInputBlur,this));s&&b.attr("disabled","disabled");return $("<div/>").addClass("dialog-input-container").append($("<span/>").addClass("dialog-input-label").text(c)).append($("<div/>").addClass("dialog-input-background").addClass("dialog-input").append(b))};
this.ma();$("body").prepend('<style type="text/css" id="plugcubed-css">\n#side-left .sidebar-content p { margin: 0; padding-top: 2px; text-indent: 15px; font-size: 10px; height:15px; }\n#side-left .sidebar-content p:hover { color:#66ff33; }\n#side-left .sidebar-content p:first-child { padding-top: 0px !important; }\n#side-left .sidebar-content h1.users { text-indent: 8px; color: #66FFFF; font-size: 16px; }\n#side-left .sidebar-content h3.waitlistspot { color: #66FFFF; text-align: left; font-size: 15px; margin-left: 8px }\n#side-left .sidebar-content p span.admin_current,#side-left .sidebar-content p span.admin_meh,#side-left .sidebar-content p span.admin_undecided,#side-left .sidebar-content p span.admin_woot,#side-left .sidebar-content p span.ambassador_current,\n#side-left .sidebar-content p span.ambassador_meh,#side-left .sidebar-content p span.ambassador_undecided,#side-left .sidebar-content p span.ambassador_woot,#side-left .sidebar-content p span.bouncer_current,#side-left .sidebar-content p span.bouncer_meh,\n#side-left .sidebar-content p span.bouncer_undecided,#side-left .sidebar-content p span.bouncer_woot,#side-left .sidebar-content p span.host_current,#side-left .sidebar-content p span.host_meh,#side-left .sidebar-content p span.host_undecided,\n#side-left .sidebar-content p span.host_woot,#side-left .sidebar-content p span.manager_current,#side-left .sidebar-content p span.manager_meh,#side-left .sidebar-content p span.manager_undecided,#side-left .sidebar-content p span.manager_woot,#side-left .sidebar-content p span.void {\n    background: url(http://tatdk.github.com/plugCubed/images/sprites.png) no-repeat;width:15px;height: 15px;position: relative;left: -5px;top:4px;display:inline-block\n}\n#side-left .sidebar-content p span.admin_current {background-position: -45px 0;}\n#side-left .sidebar-content p span.admin_meh {background-position: -30px 0;}\n#side-left .sidebar-content p span.admin_undecided {background-position: -15px 0;}\n#side-left .sidebar-content p span.admin_woot {background-position: 0 0;}\n#side-left .sidebar-content p span.ambassador_current {background-position: -45px -15px;}\n#side-left .sidebar-content p span.ambassador_meh {background-position: -30px -15px;}\n#side-left .sidebar-content p span.ambassador_undecided {background-position: -15px -15px;}\n#side-left .sidebar-content p span.ambassador_woot {background-position: 0 -15px;}\n#side-left .sidebar-content p span.bouncer_current {background-position: -45px -60px;}\n#side-left .sidebar-content p span.bouncer_meh {background-position: -30px -60px;}\n#side-left .sidebar-content p span.bouncer_undecided {background-position: -15px -60px;}\n#side-left .sidebar-content p span.bouncer_woot {background-position: 0 -60px;}\n#side-left .sidebar-content p span.host_current {background-position: -45px -30px;}\n#side-left .sidebar-content p span.host_meh {background-position: -30px -30px;}\n#side-left .sidebar-content p span.host_undecided {background-position: -15px -30px;}\n#side-left .sidebar-content p span.host_woot {background-position: 0 -30px;}\n#side-left .sidebar-content p span.manager_current {background-position: -45px -45px;}\n#side-left .sidebar-content p span.manager_meh {background-position: -30px -45px;}\n#side-left .sidebar-content p span.manager_undecided {background-position: -15px -45px;}\n#side-left .sidebar-content p span.manager_woot {background-position: 0 -45px;}\n#side-left .sidebar-content p span.void {background-position: 0px -75px;}\n#plugcubed-gui { position: absolute; margin-left:-522px; top: -320px; }\n#plugcubed-gui h2 { background-color: #0b0b0b; height: 112px; width: 156px; margin: 0; color: #fff; font-size: 13px; font-variant: small-caps; padding: 8px 0 0 12px; border-top: 1px dotted #292929; }\n#plugcubed-gui ul {list-style-type:none; margin:0; padding:0;}\n#plugcubed-gui li {float:left;}\n#plugcubed-gui p { background: #0b0b0b; height: 32px; padding-top: 8px; padding-left: 8px; cursor: pointer; font-variant: small-caps; width: 84px; font-size: 15px; margin: 0; }\n#plugcubed-gui p:hover {background-color: #3C3C3C}\n#plugcubed-gui h1 { background-color: #0b0b0b; height: 32px; padding-top: 8px; padding-left: 8px; cursor: pointer; font-variant: small-caps; width: 84px; font-size: 20px; margin: 0; }\n.sidebar {\nposition: fixed;\ntop: 0;\nheight: 100%;\nwidth: 200px;\nz-index: 99999;\n-moz-user-select: none;\n-khtml-user-select: none;\n-webkit-user-select: none;\nuser-select: none;\nbackground: rgb(69,72,77);\nbackground: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzQ1NDg0ZCIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiMwMDAwMDAiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);\nbackground: -moz-linear-gradient(top,  rgba(69,72,77,1) 0%, rgba(0,0,0,1) 100%);\nbackground: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(69,72,77,1)), color-stop(100%,rgba(0,0,0,1)));\nbackground: -webkit-linear-gradient(top,  rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%);\nbackground: -o-linear-gradient(top,  rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%);\nbackground: -ms-linear-gradient(top,  rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%);\nbackground: linear-gradient(to bottom,  rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%);\nfilter: progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#45484d\', endColorstr=\'#000000\',GradientType=0 );\n}\n.sidebar#side-left {\nleft: -220px;\nz-index: 99999;\n}\n.sidebar#side-right {\nright: -190px;\nz-index: 99999;\n}\n.sidebar-handle {\nwidth: 12px;\nheight: 100%;\nz-index: 99999;\nmargin: 0;\npadding: 0;\nbackground: #474747;\nbox-shadow: 0px 0px 15px 0px rgba(0, 0, 0, .9);\ncursor: "ne-resize";\n}\n.sidebar-handle span {\ndisplay: block;\nposition: absolute;\nwidth: 10px;\ntop: 50%;\ntext-align: center;\nletter-spacing: -1px;\ncolor: #000;\n}\n#side-left .sidebar-handle {\nfloat: right;\n}\n.sidebar-content {\nposition: absolute;\nwidth: 185px;\nfloat: left;\nheight: 100%;\npadding: 15px;\noverflow: scroll;\n}\n#side-left a {\ndisplay: block;\nmin-width: 100%;\ncursor: pointer;\npadding: 5px;\nborder-radius: 5px;\n}\n#side-left a span {\npadding-right: 8px;\n}\n#side-left a:hover {\nbackground-color: #333;\n}\n#side-left hr {\nheight: 0;\nborder: none;\nborder-top: 1px solid #AAA;\npadding: 0;\nmargin: 10px 0;\n}\n#side-right .sidebar-handle {\nfloat: left;\n}\n#side-right a {\ndisplay: block;\nmin-width: 100%;\ncursor: pointer;\npadding: 5px;\nborder-radius: 3px;\n}\n#side-right a span {\npadding-right: 8px;\n}\n#side-right a:hover {\nbackground-color: #333;\n}\n#side-right hr {\nheight: 0;\nborder: none;\nborder-top: 1px solid #AAA;\npadding: 0;\nmargin: 10px 0px 10px 3px;\n}\n[class^="status-"], [class*=" status-"] {\nborder-radius: 50%;\nwidth: 10px;\nheight: 10px;\nbackground: yellow;\ndisplay: inline-block;\nmargin-right: 5px;\n}\n.status-on { background: green; }\n.status-off { background: red; }\n#dialog-custom-colors { width: 230px; height: 360px; }\n#dialog-custom-colors .dialog-body { height: 125px; }\n#dialog-custom-colors .dialog-cancel-button { right: 100px; }\n#dialog-custom-colors .dialog-submit-button { width: 75px; }\n#dialog-custom-colors .dialog-checkbox-container-enabled { left: 10px; top: 5px; }\n#dialog-custom-colors .dialog-input-background { width: 60px; left:150px; }\n</style>');
$("body").append('<div id="side-left" class="sidebar">    <div class="sidebar-content"></div></div><div id="side-right" class="sidebar">    <div class="sidebar-handle"><span>||</span></div>    <div class="sidebar-content"></div></div>');$("body").append('<script type="text/javascript" id="plugcubed-js-extra">\n/**\n* hoverIntent r6 // 2011.02.26 // jQuery 1.5.1+\n* <http://cherne.net/brian/resources/jquery.hoverIntent.html>\n* \n* @param  f  onMouseOver function || An object with configuration options\n* @param  g  onMouseOut function  || Nothing (use configuration options object)\n* @author    Brian Cherne brian(at)cherne(dot)net\n*/\n(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind(\'mousemove\',track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t)}if(e.type==\'mouseenter\'){pX=ev.pageX;pY=ev.pageY;$(ob).bind(\'mousemove\',track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}}else{$(ob).unbind(\'mousemove\',track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)}}};return this.bind(\'mouseenter\',handleHover).bind(\'mouseleave\',handleHover)}})(jQuery);\nif (jQuery.easing.easeOutQuart === undefined) jQuery.easing.easeOutQuart = function (a,b,c,d,e) { return -d*((b=b/e-1)*b*b*b-1)+c; }\n$("#side-right")\n    .hoverIntent(function() {\n        var timeout_r = $(this)\n            .data("timeout_r");\n        if (timeout_r) {\n            clearTimeout(timeout_r);\n        }\n        $(this)\n            .animate({\n                "right": "0px"\n            }, 300, "easeOutQuart");\n    }, function() {\n        $(this)\n            .data("timeout_r", setTimeout($.proxy(function() {\n            $(this)\n                .animate({\n                    "right": "-190px"\n                }, 300, "easeOutQuart");\n       }, this), 500));\n    });\n\x3c/script>');
this.la();this.ka();this.settings.i?(this.M(),this.Y()):this.ea();var b=API.getUsers(),c;for(c in b){var d=b[c];d.j===e&&(d.j=0);d.o===e&&(d.o=0);d.f===e&&(d.f=0);d.joinTime===e&&(d.joinTime=this.da())}},close:function(){Models.chat.chatCommand=Models.chat.q;ChatModel.chatCommand=ChatModel.q;API.removeEventListener(API.DJ_ADVANCE,this.proxy.J);API.removeEventListener(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.removeEventListener(API.CURATE_UPDATE,this.proxy.I);API.removeEventListener(API.USER_JOIN,
this.proxy.K);API.removeEventListener(API.USER_LEAVE,this.proxy.L);API.removeEventListener(API.CHAT,this.proxy.H);for(var b in plugCubed.A)b===e||plugCubed.A[b]===e||($("#plugcubed-btn-"+b).unbind(),delete plugCubed.A[b]);$("#plugcubed-css").remove();$("#plugcubed-js-extra").remove();$("#side-right").remove();$("#side-left").remove();this.F.remove()},Y:function(){$("#side-left").show().animate({left:"0px"},300,"easeOutQuart");this.ca()&&(userlistShow===g&&$("#pdpUsers").hide(),$("#pdpUsersToggle").hide())},
ea:function(){var b=-$("#side-left").width()-20;$("#side-left").animate({left:b+"px"},300,"easeOutQuart",function(){$("#side-left").hide()});this.ca()&&(userlistShow===g&&$("#pdpUsers").show(),$("#pdpUsersToggle").show())},settings:{N:k,D:"",n:k,d:k,i:k,m:k,g:k,notify:k,u:k,a:{X:"B0B0B0",O:"E90E82",bouncer:"E90E82",manager:"E90E82",cohost:"E90E82",host:"E90E82",ambassador:"9A50FF",admin:"42A5DC"}},ma:function(){if(localStorage.fa!==e){var b=JSON.parse(localStorage.fa),c;for(c in this.settings)b[c]!==
e&&(this.settings[c]=b[c]);this.settings.N=k;this.settings.n&&this.ha();this.settings.i&&(this.M(),this.Y());this.settings.u&&this.ga()}},saveSettings:function(){localStorage.fa=JSON.stringify(this.settings)},ga:function(){this.settings.u?this.F.text(".chat-from { color:#"+this.settings.a.X+"!important; }.chat-from-featureddj { color:#"+this.settings.a.O+"!important; }.chat-from-bouncer { color:#"+this.settings.a.bouncer+"!important; }.chat-from-manager { color:#"+this.settings.a.manager+"!important; }.chat-from-cohost { color:#"+
this.settings.a.cohost+"!important; }.chat-from-host { color:#"+this.settings.a.host+"!important; }.chat-from-ambassador { color:#"+this.settings.a.ambassador+"!important; }.chat-from-admin { color:#"+this.settings.a.admin+"!important; }"):this.F.text("")},ka:function(){API.addEventListener(API.DJ_ADVANCE,this.proxy.J);API.addEventListener(API.VOTE_UPDATE,this.proxy.onVoteUpdate);API.addEventListener(API.CURATE_UPDATE,this.proxy.I);API.addEventListener(API.USER_JOIN,this.proxy.K);API.addEventListener(API.USER_LEAVE,
this.proxy.L);API.addEventListener(API.CHAT,this.proxy.H)},la:function(){this.k(this.settings.n,"woot","Autowoot",this.proxy.g.S);this.k(this.settings.d,"join","Autojoin",this.proxy.g.R);this.k(this.settings.i,"userlist","Userlist",this.proxy.g.W);this.k(this.settings.u,"colors","Custom Chat Colors",this.proxy.g.T);this.k(this.settings.m,"autorespond","AFK Status",this.proxy.g.Q);this.k(this.settings.notify,"notify","Notify",this.proxy.g.U);this.k(!DB.settings.streamDisabled,"stream","Stream",this.proxy.g.V)},
k:function(b,c,d,f){this.A[c]===e&&(0<$("#side-right .sidebar-content").children().length&&$("#side-right .sidebar-content").append("<hr />"),$("#side-right .sidebar-content").append('<a id="plugcubed-btn-'+c+'"><div class="status-'+(b?"on":"off")+'"></div>'+d+"</a>"),$("#plugcubed-btn-"+c).click(f),this.A[c]={text:d,callback:f})},e:function(b,c){$("#plugcubed-btn-"+b).find('[class^="status-"], [class*=" status-"]').attr("class","status-"+(c===g?"on":"off"))},M:function(){0<$("#side-left .sidebar-content").children().length&&
$("#side-left .sidebar-content").append("<hr />");$("#side-left .sidebar-content").html('<h1 class="users">Users: '+API.getUsers().length+"</h1>");var b=Models.room.getWaitListPosition(),b=$("<h3></h3>").addClass("waitlistspot").text("Waitlist: "+(b!==h?b+" / ":"")+Models.room.data.waitList.length);$("#side-left .sidebar-content").append(b).append("<hr />");var b=API.getUsers(),c;for(c in b)this.ia(b[c])},log:function(b,c,d,f){var j="";d&&(j='style="color:'+d+';"');b=c?'<div class="chat-message"><span class="chat-from" '+
j+">"+c+'</span><span class="chat-text" '+j+">: "+b+"</span></div>":'<div class="chat-message"><span class="chat-text" '+j+">"+b+"</span></div>";$("#chat-messages");$("#chat-messages").scrollTop();$("#chat-messages").outerHeight();c=Popout?Popout.Chat.chatMessages:Chat.chatMessages;d=c.scrollTop()>c[0].scrollHeight-c.height()-20;c.append(b);d&&c.scrollTop(c[0].scrollHeight);f&&$(b).click(function(){this.childNodes[0].style.color=f})},ia:function(b){var c=b.username,d;d=Models.room.data.staff[b.id]&&
Models.room.data.staff[b.id]==Models.user.BOUNCER?"bouncer":Models.room.data.staff[b.id]&&Models.room.data.staff[b.id]==Models.user.MANAGER?"manager":Models.room.data.staff[b.id]&&Models.room.data.staff[b.id]==Models.user.COHOST?"host":Models.room.data.staff[b.id]&&5==Models.room.data.staff[b.id]?"host":Models.room.ambassadors[b.id]?"ambassador":Models.room.admins[b.id]?"admin":"normal";0<Models.room.data.djs.length&&Models.room.data.djs[0].user.id==b.id?"normal"===d?this.G("void","#66FFFF",c):this.G(d+
"_current","#66FFFF",c):"normal"===d?this.G("void",this.Z(b.vote,b.curated),c):this.G(d+this.qa(b.vote),this.Z(b.vote,b.curated),c)},Z:function(b,c){var d="";if(b===e&&c!==g)d="FFFFFF";else if(c===g)d="BE187D";else switch(b){case -1:d="ED1C24";break;case 1:d="3FFF00";break;default:d="FFFFFF"}return"#"+d},qa:function(b){var c="";if(b===e)c="undecided";else switch(b){case -1:c="meh";break;case 1:c="woot";break;default:c="undecided"}return"_"+c},G:function(b,c,d){$("#side-left .sidebar-content").append('<p><span style="cursor:pointer;color:'+
c+";"+(0<Models.room.data.djs.length&&Models.room.data.djs[0].username==d?"font-size:15px;font-weight:bold;":"")+"\" onclick=\"$('#chat-input-field').val($('#chat-input-field').val() + '@"+d+' \').focus();"><span class="'+b+'"></span>'+d+"</span></p>")},getUser:function(b){"@"===b.substr(0,1)&&(b=b.substr(1));b=b.trim();var c=API.getUsers(),d;for(d in c)if(c[d].username.toLowerCase()===b.toLowerCase()||c[d].id.toLowerCase()===b.toLowerCase())return c[d];return h},P:function(b,c){if(Models.room.data.staff[Models.user.data.id]&&
Models.room.data.staff[Models.user.data.id]>=Models.user.BOUNCER){var d;switch(c){case "kick":d=ModerationKickUserService;break;case "removedj":d=ModerationRemoveDJService;break;case "adddj":d=ModerationAddDJService;break;default:log("Unknown moderation");return}var f=this.getUser(b);f===h?log("user not found"):new d(f.id," ")}},ja:function(b){b=this.getUser(b);if(b===h)log("user not found");else{var c,d,f,j,n=b.djPoints+b.curatorPoints+b.listenerPoints,l=b.j+b.o;f=Models.room.getWaitListPosition(b.id);
d=-1;c=Models.room.data.staff[b.id]&&Models.room.data.staff[b.id]==Models.user.FEATUREDDJ?"Featured DJ":Models.room.data.staff[b.id]&&Models.room.data.staff[b.id]==Models.user.BOUNCER?"Bouncer":Models.room.data.staff[b.id]&&Models.room.data.staff[b.id]==Models.user.MANAGER?"Manager":Models.room.data.staff[b.id]&&Models.room.data.staff[b.id]==Models.user.COHOST?"Co-Host":Models.room.data.staff[b.id]&&5==Models.room.data.staff[b.id]?"Host":Models.room.ambassadors[b.id]?"Ambassador":Models.room.admins[b.id]?
"Admin":"User";if(f===h){for(f=1;f<Models.room.data.djs.length;f++)d=Models.room.data.djs[f].user.id===Models.user.data.id?f:d;j=0>d?"Not in waitlist nor booth":d+1+"/"+Models.room.data.djs.length+" in booth"}else j=f+"/"+Models.room.data.ta.length+" in waitlist";switch(b.status){case -1:d="Idle";break;default:d="Available";break;case 1:d="AFK";break;case 2:d="Working";break;case 3:d="Sleeping"}switch(b.vote){case -1:f="Meh";break;default:f="Undecided";break;case 1:f="Woot"}this.log('<table style="width:100%"><tr><td colspan="2"><strong>Name</strong>: <span style="color:#FFFFFF">'+
b.username+'</span></td></tr><tr><td colspan="2"><strong>ID</strong>: <span style="color:#FFFFFF">'+b.id+'</span></td></tr><tr><td><strong>Rank</strong>: <span style="color:#FFFFFF">'+c+'</span></td><td><strong>Time Joined</strong>: <span style="color:#FFFFFF">'+b.joinTime+'</span></td></tr><tr><td><strong>Status</strong>: <span style="color:#FFFFFF">'+d+'</span></td><td><strong>Vote</strong>: <span style="color:#FFFFFF">'+f+'</span></td></tr><tr><td colspan="2"><strong>Position</strong>: <span style="color:#FFFFFF">'+
j+'</span></td></tr><tr><td><strong>Points</strong>: <span style="color:#FFFFFF">'+n+'</span></td><td><strong>Fans</strong>: <span style="color:#FFFFFF">'+b.fans+'</span></td></tr><tr><td><strong>Woot Count</strong>: <span style="color:#FFFFFF">'+b.j+'</span></td><td><strong>Meh Count</strong>: <span style="color:#FFFFFF">'+b.o+'</span></td></tr><tr><td colspan="2"><strong>Woot/Meh ratio</strong>: <span style="color:#FFFFFF">'+(0===l?"0":(b.j/l).toFixed(2))+"</span></td></tr></table>",h,"#cc00cc")}},
S:function(){this.settings.n=!this.settings.n;this.e("woot",this.settings.n);this.settings.n&&$("#button-vote-positive").click();this.saveSettings()},R:function(){this.settings.d=!this.settings.d;this.e("join",this.settings.d);this.settings.d&&0<$("#button-dj-waitlist-join").length&&API.waitListJoin();this.saveSettings()},W:function(){this.settings.i=!this.settings.i;this.e("userlist",this.settings.i);this.settings.i?(this.M(),this.Y()):($("#side-left .sidebar-content").empty(),this.ea());this.saveSettings()},
Q:function(){this.settings.m=!this.settings.m;this.e("autorespond",this.settings.m);if(this.settings.m){var b=prompt("Please enter your away message here.\nThis is what you will reply via @mention.",""===this.settings.D?this.ba:this.settings.D);if(b===h){this.settings.m=k;this.e("autorespond",k);return}this.settings.D=""===b.trim()?this.ba:b;2!=Models.user.data.status&&Models.user.changeStatus(1)}else Models.user.changeStatus(0);this.saveSettings()},U:function(){this.settings.notify=!this.settings.notify;
this.e("notify",this.settings.notify);this.log("Join/leave alerts "+(this.settings.notify?"enabled":"disabled"),h,plugCubed.a.B);this.saveSettings()},V:function(){this.e("stream",DB.settings.streamDisabled);API.sendChat(DB.settings.streamDisabled?"/stream on":"/stream off")},T:function(){Dialog.closeDialog();Dialog.context="isCustomChatColors";Dialog.submitFunc=$.proxy(this.oa,this);Dialog.showDialog($("<div/>").attr("id","dialog-custom-colors").addClass("dialog").css("left",Main.LEFT+(Main.WIDTH-
230)/2).css("top",208.5).append(Dialog.getHeader("Custom Chat Colors")).append($("<div/>").addClass("dialog-body").append($("<form/>").submit("return false").append(Dialog.getCheckBox("Enable custom","enabled",this.settings.u)).append($(Dialog.getInputField("regular","Regular","B0B0B0",this.settings.a.X,6)).css("top",30)).append($(Dialog.getInputField("featureddj","Featured DJ","E90E82",this.settings.a.O,6)).css("top",60)).append($(Dialog.getInputField("bouncer","Bouncer","E90E82",this.settings.a.bouncer,
6)).css("top",90)).append($(Dialog.getInputField("manager","Manager","E90E82",this.settings.a.manager,6)).css("top",120)).append($(Dialog.getInputField("cohost","Co-Host","E90E82",this.settings.a.cohost,6)).css("top",150)).append($(Dialog.getInputField("host","Host","E90E82",this.settings.a.host,6)).css("top",180)).append($(Dialog.getInputField("ambassador","Ambassador","9A50FF",this.settings.a.ambassador,6)).css("top",210)).append($(Dialog.getInputField("admin","Admin","42A5DC",this.settings.a.admin,
6)).css("top",240)))).append(Dialog.getCancelButton()).append(Dialog.getSubmitButton(Lang.dialog.save)))},oa:function(){var b=$("input[name=regular]"),c=$("input[name=featureddj]"),d=$("input[name=bouncer]"),f=$("input[name=manager]"),j=$("input[name=cohost]"),n=$("input[name=host]"),l=$("input[name=ambassador]"),p=$("input[name=admin]");this.settings.u=$("#dialog-checkbox-enabled").is(":checked");this.settings.a.X=""===b.val()||!r(b.val())?b.data("ph"):b.val();this.settings.a.O=""===c.val()||!r(c.val())?
c.data("ph"):c.val();this.settings.a.bouncer=""===d.val()||!r(d.val())?d.data("ph"):d.val();this.settings.a.manager=""===f.val()||!r(f.val())?f.data("ph"):f.val();this.settings.a.cohost=""===j.val()||!r(j.val())?j.data("ph"):j.val();this.settings.a.host=""===n.val()||!r(n.val())?n.data("ph"):n.val();this.settings.a.ambassador=""===l.val()||!r(l.val())?l.data("ph"):l.val();this.settings.a.admin=""===p.val()||!r(p.val())?p.data("ph"):p.val();this.ga();this.e("colors",this.settings.u);this.saveSettings();
Dialog.closeDialog()},onVoteUpdate:function(b){var c=Models.room.userHash[b.user.id];this.C();0!==c.f&&(1==c.f?c.j--:-1==c.f&&c.o--);1==b.vote?c.j++:-1==b.vote&&c.o++;c.f=b.vote},I:function(b){var c=API.getMedia();this.settings.notify===g&&this.log(b.user.username+" added "+c.author+" - "+c.title,h,this.a.curates);Models.room.userHash[b.user.id].curated=g;this.C()},J:function(){setTimeout($.proxy(this.pa,this),Math.ra());this.C();var b=API.getUsers(),c;for(c in b)b[c].f=0},pa:function(){this.settings.n&&
this.ha();"block"===$("#button-dj-waitlist-join").css("display")&&this.settings.d&&API.waitListJoin()},ha:function(){var b=Models.room.data.djs[0];b!==h&&b!=API.getSelf()&&$("#button-vote-positive").click()},K:function(b){this.settings.notify===g&&this.log(b.username+" joined the room",h,this.a.userJoin);b=Models.room.userHash[b.id];b.j===e&&(b.j=0);b.o===e&&(b.o=0);b.f===e&&(b.f=0);b.joinTime===e&&(b.joinTime=this.da());this.C()},L:function(b){this.settings.notify===g&&this.log(b.username+" left the room",
h,this.a.userLeave);this.C()},H:function(b){"mention"==b.type&&(Models.room.data.staff[b.fromID]&&Models.room.data.staff[b.fromID]>=Models.user.BOUNCER&&0<b.message.indexOf("!disable")?this.settings.d?(this.settings.d=k,this.e("join",this.settings.d),this.saveSettings(),API.waitListLeave(),API.sendChat("@"+b.from+" Autojoin disabled")):API.sendChat("@"+b.from+" Autojoin was not enabled"):this.settings.m&&!this.settings.N&&(this.settings.N=g,setTimeout(function(){plugCubed.settings.N=k;plugCubed.saveSettings()},
18E4),API.sendChat("@"+b.from+" "+this.settings.D)))},C:function(){this.settings.i&&this.M()},da:function(){var b=new Date,c=b.getMinutes();return b.getHours()+":"+((10>c?"0":"")+c)},aa:function(b){if(Models.chat.q(b)===g)return("/stream on"==b||"/stream off"==b)&&plugCubed.e("stream",!DB.settings.streamDisabled),"/afk"==b&&plugCubed.settings.d&&(plugCubed.settings.d=k,plugCubed.e("join",k),plugCubed.saveSettings()),g;if(0===b.indexOf("/commands"))return b="<strong>User Commands</strong>;/nick - change username;/idle - set status to idle;/avail - set status to available;/afk - set status to afk;/work - set status to working;/sleep - set status to sleeping;/leave - leaves dj booth/waitlist;/woot - woots current song;/meh - mehs current song;/curate - add current song to your selected playlist;/getpos - get current waitlist position;/version - displays version number;/commands - shows this list".split(";"),
plugCubed.log(b.join("<br />"),h,plugCubed.a.sa),Models.user.hasPermission(Models.user.BOUNCER)&&(b="<strong>Moderation Commands</strong>;/whois (username) - gives general information about user;/skip - skip current song;/kick (username) - kicks targeted user;/lock - locks DJ booth;/unlock - unlocks DJ booth;/add (username) - adds targeted user to dj booth/waitlist;/remove (username) - removes targeted user from dj booth/waitlist".split(";"),plugCubed.log(b.join("<br />"),h,plugCubed.a.na)),g;if("/idle"==
b)return Models.user.changeStatus(-1),g;if("/avail"==b||"/available"==b)return Models.user.changeStatus(0),g;if("/brb"==b||"/away"==b)return Models.user.changeStatus(1),plugCubed.settings.d&&(plugCubed.settings.d=k,plugCubed.e("join",k),plugCubed.saveSettings()),g;if("/work"==b||"/working"==b)return Models.user.changeStatus(2),g;if("/sleep"==b||"/sleeping"==b)return Models.user.changeStatus(3),plugCubed.settings.d&&(plugCubed.settings.d=k,plugCubed.e("join",k),plugCubed.saveSettings()),g;if("/join"==
b)return API.waitListJoin(),g;if("/leave"==b)return API.waitListLeave(),g;if("/woot"==b)return $("#button-vote-positive").click(),g;if("/meh"==b)return $("#button-vote-negative").click(),g;if("/version"==b)return plugCubed.log(plugCubed.version,h,plugCubed.a.B),g;if(0===b.indexOf("/nick "))return Models.user.changeDisplayName(b.substr(6)),g;if(0===b.indexOf("/curate"))return new DJCurateService(Models.playlist.selectedPlaylistID),setTimeout(function(){Dialog.closeDialog()},500),g;if("/alertsoff"==
b)return plugCubed.settings.notify&&(plugCubed.log("Join/leave alerts disabled",h,plugCubed.a.B),plugCubed.settings.notify=k,plugCubed.e("notify",k)),g;if("/alertson"==b)return plugCubed.settings.notify||(plugCubed.log("Join/leave alerts enabled",h,plugCubed.a.B),plugCubed.settings.notify=g,plugCubed.e("notify",g)),g;if("/getpos"==b){b=Models.room.getWaitListPosition();if(b!==h)plugCubed.log("Position in waitlist "+b+"/"+Models.room.data.waitList.length,h,plugCubed.a.z);else{b=-1;for(var c=1;c<Models.room.data.djs.length;c++)b=
Models.room.data.djs[c].user.id===Models.user.data.id?c:b;0>c?plugCubed.log("Not in waitlist nor booth",h,plugCubed.a.z):0===c?plugCubed.log("You are DJing",h,plugCubed.a.z):1===c?plugCubed.log("You are DJing next",h,plugCubed.a.z):plugCubed.log("Position in booth "+(b+1)+"/"+Models.room.data.djs.length,h,plugCubed.a.z)}return g}if(Models.user.hasPermission(Models.user.BOUNCER)){if(0===b.indexOf("/whois "))return plugCubed.ja(b.substr(7)),g;if("/skip"==b)return new ModerationForceSkipService,g;if(0===
b.indexOf("/kick "))return plugCubed.P(b.substr(6),"kick"),g;if(0===b.indexOf("/add "))return plugCubed.P(b.substr(5),"adddj"),g;if(0===b.indexOf("/remove "))return plugCubed.P(b.substr(8),"removedj"),g}if(Models.user.hasPermission(Models.user.MANAGER)){if(0===b.indexOf("/lock"))return new RoomPropsService(Slug,g,Models.room.data.waitListEnabled,Models.room.data.maxPlays,Models.room.data.maxDJs),g;if(0===b.indexOf("/unlock"))return new RoomPropsService(Slug,k,Models.room.data.waitListEnabled,Models.room.data.maxPlays,
Models.room.data.maxDJs),g}return k}});if(jQuery&&1===$("#plugcubed-js").length&&-1===$("#plugcubed-js").attr("src").indexOf("raw.github.com"))var plugCubed=new t;else confirm("You need to update your plugCubed URL\nPlease click OK to visit our page to get the new URL.")&&window.open("http://tatdk.github.com/plugCubed/","_blank");
